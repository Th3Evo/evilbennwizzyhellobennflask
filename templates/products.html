{% extends "base.html" %}

{% block title %}Welcome to Rosla{% endblock %}

{% block content %}

<h1>Our Products</h1>

<div class="products">
    {% for product in products %}
        <div class="product-card">
            <h2>{{ product[1] }}</h2>
            <p>{{ product[2] }}</p>
        </div>
    {% endfor %}
</div>

{% endblock %}

<script>
    emailjs.init({ publicKey: "PUBLIC_KEY" }); // your public key
  
    function makeTempPassword(length = 12) {
      // simple strong-ish demo password generator
      const chars = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%";
      let out = "";
      for (let i = 0; i < length; i++) {
        out += chars[Math.floor(Math.random() * chars.length)];
      }
      return out;
    }
  
    window.addEventListener("load", () => {
      const form = document.getElementById("energy-form");
      if (!form) return;
  
      form.addEventListener("submit", (event) => {
        event.preventDefault();
  
        // Generate temp password and inject into form
        const pwd = makeTempPassword(12);
        document.getElementById("temp_password").value = pwd;
  
        // Add product name if you want it in the email
        // (or add <input type="hidden" name="product_name" value="{{product['name']}}"> in HTML)
        // For demo, we can set it dynamically if a hidden exists:
        const productsHidden = form.querySelector('input[name="products_name"]');
        if (productsHidden) productsHidden.value = "{{ products['name'] }}";
  
        // Send email using EmailJS
        emailjs.sendForm("SERVICE_KEY", "TEMPLATE_ID", form)
          .then(() => {
            console.log("EmailJS SUCCESS");
  
            // After email is sent, submit to Flask to create account + store calc
            form.submit();
          })
          .catch((err) => {
            console.error("EmailJS FAILED:", err);
            alert("Email failed to send. Check console.");
          });
      });
    });
  </script>